# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ö—ç—à-—Ç–∞–±–ª–∏—Ü—ã
## –ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä –∏ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –∫–∞–º–µ–Ω—å
–ß–∞—Å—Ç–æ—Ç–∞ –ø–æ—è–≤–ª–µ–Ω–∏—è "Harry" - 1327, "Ron" - 429, "Hermione" - 270. –û—Ç–∫—É–¥–∞ –∏–Ω—Ñ–æ—Ä—Ä–º–∞—Ü–∏—è ? - –•—ç—à - —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞—à–ª–∞:)
## üìå –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞
–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Å—Ç—Ä–æ–∫ —Å –∞–Ω–∞–ª–∏–∑–æ–º —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–π –∏ –º–µ—Ç–æ–¥–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

## üîç –ó–∞–¥–∞—á–∏

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è —Ç—Ä–∏ –º–µ—Ç–æ–¥–∞:

- **–ß–∏—Å—Ç—ã–π –∞—Å—Å–µ–º–±–ª–µ—Ä** ‚Äî –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ —á–∞—Å—Ç–∏ –∫–æ–¥–∞ –Ω–∞ ASM.  
- **–ê—Å—Å–µ–º–±–ª–µ—Ä–Ω—ã–µ –≤—Å—Ç–∞–≤–∫–∏** ‚Äî —Ç–æ—á–µ—á–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.  
- **SIMD-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** ‚Äî –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (SSE/AVX).  

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—ë–º –∞—Å—Å–µ–º–±–ª–µ—Ä–Ω–æ–≥–æ –∫–æ–¥–∞.  
- –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:  

  \[
  \text{–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É—Å–∫–æ—Ä–µ–Ω–∏—è} = \frac{\text{–í—Ä–µ–º—è –¥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏}}{\text{–í—Ä–µ–º—è –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏}} \times 1000
  \]

## –ù–∞—á–Ω–µ–º –∏—Å–∫–∞—Ç—å –≥–æ—Ä—è—á–∏–µ —Ç–æ—á–∫–∏

–î–ª—è –Ω–∞—á–∞–ª–∞ —É–±–µ—Ä–µ–º –ø—É–Ω–∫—Ç—É–∞—Ü–∏—é –∏ –ø–µ—Ä–µ–≤–µ–¥–µ–º –≤—Å–µ –±—É–∫–≤—ã –≤ —Å—Ç—Ä–æ—á–Ω—ã–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π (–ø–∞–ø–∫–∞ tools prepare_words.cpp), —á—Ç–æ–±—ã –∑–∞–º–µ—Ä—è—Ç—å –∏–º–µ–Ω–Ω–æ –ø–æ–∏—Å–∫. –í–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è valgrind –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ :

![–ü–µ—Ä–≤—ã–π –∑–∞–º–µ—Ä](callgrind/time_1.png)

–ü–µ—Ä–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è hash 

```c
unsigned long hash(const char *key)
{
    assert(key);

    unsigned long hash = 5381;

    for (size_t i = 0; key[i] != '\0'; i++)

         hash = ((hash << 5) + hash) + (size_t) (key[i]); // hash * 33 + c


    return hash;
}
```

–î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ö—ç—à-—Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å  _mm_crc32_u64

```c
uint32_t hash_intrinsic(const char* word)
{
    uint64_t hash = 0;
    hash = _mm_crc32_u64(hash, *((const uint64_t*)(word)));     //process only 4 byte
    hash = _mm_crc32_u64(hash, *((const uint64_t*)(word + 8)));
    hash = _mm_crc32_u64(hash, *((const uint64_t*)(word + 16)));
    hash = _mm_crc32_u64(hash, *((const uint64_t*)(word + 24)));
    return (uint32_t)hash;
}
```

![–í—Ç–æ—Ä–æ–π –∑–∞–º–µ—Ä](callgrind/time_2.png)

–û—Ü–µ–Ω–∏–≤–∞—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É—Å–∫–æ—Ä–µ–Ω–∏—è –±—É–¥–µ–º –ø–æ Self (–≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤)

| –§—É–Ω–∫—Ü–∏—è       | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—Ç–∞–∫—Ç—ã) | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—Ç–∞–∫—Ç—ã) | –£—Å–∫–æ—Ä–µ–Ω–∏–µ |
|---------------|-----------------------|--------------------------|-----------|
| `hash()`      | 352 176 496           | 57 018 136               | **6.18√ó** |
